<div class="container my-5" *ngIf="cartItems.length > 0; else emptyCart">
  <br>
  <!-- Paso de proceso -->
  <div class="checkout-steps d-flex justify-content-between mb-4 mt-3">
    <div class="step" [class.active]="step == 1">Carrito de compras</div>
    <div class="step" [class.active]="step == 2">Identif√≠cate</div>
    <div class="step" [class.active]="step == 3">Env√≠o y pago</div>
    <div class="step" [class.active]="step == 4">Pedido confirmado</div>
  </div>

  <div *ngIf="step === 1">
      <div class="row">
        <!-- Columna productos -->
        <div class="col-md-8">
          <div class="list-group mb-4">
            <div class="list-group-item d-flex justify-content-between align-items-center"
                *ngFor="let item of cartItems; let i = index">
              <div class="d-flex align-items-center">
                <img [src]="'https://abstractbeezzz.com/back/' + item.image_1_url"
                    alt="{{ item.name }}" class="img-thumbnail me-3"
                    style="width: 80px; height: 80px; object-fit: cover;">
                <div>
                  <h5 class="mb-1">{{ item.name }}</h5>
                  <div class="d-flex align-items-center">
                    <button class="btn btn-sm btn-outline-secondary me-2"
                            (click)="item.quantity = item.quantity! - 1; calcularTotales()"
                            [disabled]="item.quantity! <= 1">-</button>
                    <span>{{ item.quantity }}</span>
                    <button class="btn btn-sm btn-outline-secondary ms-2"
                            (click)="item.quantity = item.quantity! + 1; calcularTotales()">+</button>
                  </div>
                </div>
              </div>
              <div>
                <h5 class="text-success mb-0">$ {{ item.price * item.quantity | number:'1.0-0' }}</h5>
                <button class="btn btn-sm btn-outline-danger mt-2"
                        (click)="removeFromCart(i)">
                  ‚úï
                </button>
              </div>
            </div>
          </div>

          <!-- Opciones de env√≠o -->
          <div class="card mb-4">
            <div class="card-body">
              <h5>Entrega</h5>
              <p class="text-muted">Vea todas las opciones de env√≠o para sus productos, incluyendo plazos y precios</p>
              <button class="btn btn-outline-dark">Calcular</button>
            </div>
          </div>
        </div>

        <!-- Columna resumen -->
        <div class="col-md-4">
          <div class="card p-3">
            <div class="card-body">
              <h5 class="mb-3">Resumen de compra</h5>
              <div class="d-flex justify-content-between">
                <span>Subtotal</span>
                <span>$ {{ subtotal | number:'1.0-0' }}</span>
              </div>
              <div class="d-flex justify-content-between">
                <span>Env√≠o</span>
                <span>$ {{ shipping | number:'1.0-0' }}</span>
              </div>
              <hr>
              <div class="d-flex justify-content-between fw-bold">
                <span>Total</span>
                <span>$ {{ total | number:'1.0-0' }}</span>
              </div>
              <button class="btn btn-danger btn-fucsia btn-lg w-100 mt-3"
                      (click)="step = 2">Finalizar compra</button>
            </div>
          </div>
        </div>
      </div>
      <!-- tu carrito existente -->
      <!-- <button class="btn btn-danger w-100 mt-3" (click)="step = 2">Continuar</button> -->
  </div>

  <!-- Paso 2: Identif√≠cate -->
  <div *ngIf="step === 2">
    <h4>Datos del comprador</h4>
    <form (ngSubmit)="guardarDatos()" #datosForm="ngForm">
      <div class="mb-3">
        <label>Nombre</label>
        <input type="text" class="form-control" required  name="nombre">
      </div>
      <div class="mb-3">
        <label>Email</label>
        <input type="email" class="form-control" required name="email">
      </div>
      <div class="mb-3">
        <label>Direcci√≥n</label>
        <input type="text" class="form-control" required name="direccion">
      </div>
      <button class="btn btn-secondary me-2" type="button" (click)="step = 1">Atr√°s</button>
      <button class="btn btn-primary" type="button" (click)="step = 3">Continuar al pago</button>
    </form>
  </div>

  <!-- Paso 3: Pago con Stripe -->
  <div *ngIf="step === 3">
    <h4>Pago</h4>
    <p>Total a pagar: <strong>$ {{ total | number:'1.0-0' }}</strong></p>
    <button class="btn btn-secondary me-2" (click)="step = 2">Atr√°s</button>
    <button class="btn btn-success" (click)="pagarConStripe()">Pagar con Stripe</button>
  </div>

  <!-- Paso 4: Confirmaci√≥n -->
  <div *ngIf="step === 4">
    <h4 *ngIf="pagoExitoso">üéâ Pedido confirmado</h4>
    <h4 *ngIf="!pagoExitoso">‚ùå El pago no se complet√≥</h4>
    <p *ngIf="pagoExitoso">Gracias por tu compra, recibir√°s un correo con los detalles.</p>
    <p *ngIf="!pagoExitoso">Puedes intentarlo de nuevo.</p>
    <button class="btn btn-primary" (click)="volverATienda()">Volver a la tienda</button>
  </div>


</div>

<ng-template #emptyCart>
  <div class="text-center mt-5 mb-4">
    <h4>Tu carrito est√° vac√≠o</h4>
    <button class="btn btn-primary mt-3" (click)="volverATienda()">Volver a la tienda</button>
  </div>
</ng-template>
